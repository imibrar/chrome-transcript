import{c as e,d as t,g as n,_ as i,h as r,a as o,b as s,i as a,p as c,f as d,P as g}from"./chunk-QIZ4XBKF-ZtkyFXsM.js";var l=o(),p=new Map,u=new Map,f=new Map,m=(e,t)=>(u.set(e,(u.get(e)||new Set).add(t)),()=>{const n=u.get(e);(null==n?void 0:n.delete(t))&&0===(null==n?void 0:n.size)&&u.delete(e)}),b=(e,t)=>{f.set(e,(f.get(e)||new Set).add(t))},h=e=>({withFingerprint:t=>{const n=e=>({and:()=>e}),i={aboutIncomingMessage:t=>{const r=p.get(e);return g.toExtensionContext(r.port,{status:"incoming",message:t}),n(i)},aboutSuccessfulDelivery:t=>{const r=p.get(e);return g.toExtensionContext(r.port,{status:"delivered",receipt:t}),n(i)},aboutMessageUndeliverability:(r,o)=>{const s=p.get(e);return(null==s?void 0:s.fingerprint)===t&&g.toExtensionContext(s.port,{status:"undeliverable",resolvedDestination:r,message:o}),n(i)},whenDeliverableTo:r=>{const o=()=>{const n=p.get(e);if((null==n?void 0:n.fingerprint)===t&&p.has(r))return g.toExtensionContext(n.port,{status:"deliverable",deliverableTo:r}),!0};if(!o()){const e=m(r,o);b(t,e)}return n(i)},aboutSessionEnded:r=>{const o=p.get(e);return(null==o?void 0:o.fingerprint)===t&&g.toExtensionContext(o.port,{status:"terminated",fingerprint:r}),n(i)}};return i}}),v=e(),w=t("background",e=>{var t;if("background"===e.origin.context&&["content-script","devtools "].includes(e.destination.context)&&!e.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const o=n(i(i({},e.origin),"window"===e.origin.context&&{context:"content-script"})),s=n(r(i(i({},e.destination),"window"===e.destination.context&&{context:"content-script"}),{tabId:e.destination.tabId||e.origin.tabId}));e.destination.tabId=null,e.destination.frameId=null;const a=()=>p.get(s),c=()=>p.get(o),d=()=>{var t;h(s).withFingerprint(a().fingerprint).aboutIncomingMessage(e);const n={message:e,to:a().fingerprint,from:{endpointId:o,fingerprint:null==(t=c())?void 0:t.fingerprint}};"message"===e.messageType&&l.add(n),"reply"===e.messageType&&l.remove(e.messageID),c()&&h(o).withFingerprint(c().fingerprint).aboutSuccessfulDelivery(n)};(null==(t=a())?void 0:t.port)?d():"message"===e.messageType&&("background"===e.origin.context?m(s,d):c()&&h(o).withFingerprint(c().fingerprint).aboutMessageUndeliverability(s,e).and().whenDeliverableTo(s))},e=>{const t=n(i(i({},e.origin),"window"===e.origin.context&&{context:"content-script"})),r=p.get(t),o={message:e,to:v,from:{endpointId:t,fingerprint:r.fingerprint}};h(t).withFingerprint(r.fingerprint).aboutSuccessfulDelivery(o)});s.runtime.onConnect.addListener(e=>{var t;const i=a(e.name);if(!i)return;i.endpointName||(i.endpointName=n({context:"content-script",tabId:e.sender.tab.id,frameId:e.sender.frameId}));const{tabId:r,frameId:o}=c(i.endpointName);p.set(i.endpointName,{fingerprint:i.fingerprint,port:e}),null==(t=u.get(i.endpointName))||t.forEach(e=>e()),u.delete(i.endpointName),b(i.fingerprint,()=>{const e=l.entries().filter(e=>e.to===i.fingerprint);l.remove(e),e.forEach(e=>{"background"===e.from.endpointId?w.endTransaction(e.message.transactionId):h(e.from.endpointId).withFingerprint(e.from.fingerprint).aboutSessionEnded(i.fingerprint)})}),e.onDisconnect.addListener(()=>{var e,t;(null==(e=p.get(i.endpointName))?void 0:e.fingerprint)===i.fingerprint&&p.delete(i.endpointName),null==(t=f.get(i.fingerprint))||t.forEach(e=>e()),f.delete(i.fingerprint)}),e.onMessage.addListener(e=>{var t,n;if("sync"===e.type){const t=[...p.values()].map(e=>e.fingerprint),n=e.pendingResponses.filter(e=>t.includes(e.to));return l.add(...n),e.pendingResponses.filter(e=>!t.includes(e.to)).forEach(e=>h(i.endpointName).withFingerprint(i.fingerprint).aboutSessionEnded(e.to)),void e.pendingDeliveries.forEach(e=>h(i.endpointName).withFingerprint(i.fingerprint).whenDeliverableTo(e))}"deliver"===e.type&&(null==(n=null==(t=e.message)?void 0:t.origin)?void 0:n.context)&&(e.message.origin.tabId=r,e.message.origin.frameId=o,w.handleMessage(e.message))})});var{sendMessage:y,onMessage:I}=w;d(w),I("AUTH",async e=>await chrome.identity.launchWebAuthFlow(e.data)),I("LOGOUT",async e=>{await chrome.identity.clearAllCachedAuthTokens()}),I("CURRENT_TAB",async e=>{const[t]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return t}),chrome.runtime.onInstalled.addListener(async e=>{"install"===e.reason&&(chrome.tabs.create({url:"https://yt-transcript.tilda.ws/welcome"}),chrome.runtime.setUninstallURL("https://yt-transcript.tilda.ws/uninstall"),async function(){try{const t=await chrome.tabs.query({url:x}),n=chrome.runtime.getManifest().content_scripts[0].js[0];for(const i of t)if(i.id&&i.url)try{await chrome.scripting.executeScript({target:{tabId:i.id},files:[n]})}catch(e){console.warn(`Could not inject script to tab ${i.id}:`,e)}}catch(e){console.error("Error injecting content scripts:",e)}}()),e.reason}),chrome.runtime.onMessageExternal.addListener(async(e,t)=>{if(e.status&&"subscribed"===e.status&&e.tabID)try{await chrome.tabs.sendMessage(e.tabID,{subscribed:!0})}catch(n){console.info(n)}if("openTab"===e.status&&e.tabID)try{await chrome.tabs.update(e.tabID,{active:!0})}catch(n){console.info(n)}});const x=["*://*.youtube.com/*","*://*.youtu.be/*"];self.onerror=function(e,t,n,i,r){console.info("Error: "+e),console.info("Source: "+t),console.info("Line: "+n),console.info("Column: "+i),console.info("Error object: "+r)};
